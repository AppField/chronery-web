<mat-toolbar color="primary" class="mat-elevation-z8">
    <mat-progress-bar mode="indeterminate" color="accent" *ngIf="isLoading" class="top-loader"></mat-progress-bar>
    Report
    <span class="fill-remaining-space">
    </span>
    <button mat-button (click)="exportReportToCSV()">
        Export
        <mat-icon>import_export</mat-icon>
    </button>
</mat-toolbar>

<div class="inner-sidenav-content">
    <div class="mat-elevation-z5">
        <div class="table-header" fxLayout.gt-xs="row" fxLayout="column" fxLayoutGap="20px" fxLayoutGap.xs="0">

            <!-- Start date -->
            <mat-form-field fxFlex="100">
                <input matInput [matDatepicker]="fromPicker" placeholder="Starts at"
                       [max]="endDate" [(ngModel)]="startDate" autocomplete="off">
                <mat-datepicker-toggle mdSuffix [for]="fromPicker"></mat-datepicker-toggle>
                <mat-datepicker #fromPicker [startAt]="startDate"
                               (selectedChanged)="updateReport()"
                               [touchUi]="isMobile">
                </mat-datepicker>
            </mat-form-field>

            <!-- End date -->
            <mat-form-field fxFlex="100">
                <input matInput [matDatepicker]="toPicker" placeholder="Ends at"
                       [min]="startDate" [(ngModel)]="endDate" autocomplete="off">
                <mat-datepicker-toggle mdSuffix [for]="toPicker"></mat-datepicker-toggle>
                <mat-datepicker #toPicker (selectedChanged)="updateReport()" [touchUi]="isMobile"></mat-datepicker>
            </mat-form-field>

            <!-- Proejct Autocomplete -->
            <mat-form-field fxFlex="100">
                <input matInput placeholder="Project" [matAutocomplete]="auto" [formControl]="projectsCtrl" [(ngModel)]="selectedProject">
                <mat-error>Required</mat-error>
            </mat-form-field>
            <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn" (optionSelected)="updateReport()">
                <mat-option *ngFor="let project of filteredProjects | async" [value]="project">
                    <span>{{ project.name }}  <span *ngIf="project.number">|</span>  <small>{{ project.number }} </small></span>
                </mat-option>
            </mat-autocomplete>
        </div>


        <mat-table #table [dataSource]="dataSource">
            <!-- Project number column -->
            <ng-container cdkColumnDef="date">
                <mat-header-cell *cdkHeaderCellDef><strong>Date</strong></mat-header-cell>
                <mat-cell *cdkCellDef="let row" fxLayout="row">
                    <div fxHide.gt-sm fxFlex="50"><strong>Date</strong></div>
                    <div fxFlex="50"><strong>{{row.date | encodedDate}}</strong></div>
                </mat-cell>
            </ng-container>

            <!-- Project name column -->
            <ng-container cdkColumnDef="from">
                <mat-header-cell *cdkHeaderCellDef>From</mat-header-cell>
                <mat-cell *cdkCellDef="let row" fxLayout="row">
                    <div fxHide.gt-sm fxFlex="50"><strong>From</strong></div>
                    <div fxFlex="50">{{row.from}} h</div>
                </mat-cell>
            </ng-container>

            <ng-container cdkColumnDef="to">
                <mat-header-cell *cdkHeaderCellDef>To</mat-header-cell>
                <mat-cell *cdkCellDef="let row" fxLayout="row">
                    <div fxHide.gt-sm fxFlex="50">
                        <strong>To</strong>
                    </div>
                    <div fxFlex="50">{{row.to}} h</div>
                </mat-cell>
            </ng-container>

            <ng-container cdkColumnDef="spent">
                <mat-header-cell *cdkHeaderCellDef><strong>Spent</strong></mat-header-cell>
                <mat-cell *cdkCellDef="let row" fxLayout="row">
                    <div fxHide.gt-sm fxFlex="50"><strong>Spent</strong></div>
                    <div fxFlex="50"><strong>{{row.spent}} h</strong></div>
                </mat-cell>
            </ng-container>

            <ng-container cdkColumnDef="projectNumber">
                <mat-header-cell *cdkHeaderCellDef>Project Number</mat-header-cell>
                <mat-cell *cdkCellDef="let row" fxLayout="row">
                    <div fxHide.gt-sm fxFlex="50"><strong>Project Number</strong></div>
                    <div fxFlex="50">{{row.project.number}}</div>
                </mat-cell>
            </ng-container>

            <ng-container cdkColumnDef="projectName">
                <mat-header-cell *cdkHeaderCellDef>Project Name</mat-header-cell>
                <mat-cell *cdkCellDef="let row" fxLayout="row">
                    <div fxHide.gt-sm fxFlex="50"><strong>Project Name</strong></div>
                    <div fxFlex="50">{{row.project.name}}</div>
                </mat-cell>
            </ng-container>

            <ng-container cdkColumnDef="comment">
                <mat-header-cell *cdkHeaderCellDef>Comment</mat-header-cell>
                <mat-cell *cdkCellDef="let row" fxLayout="row">
                    <div fxHide.gt-sm fxFlex="50"><strong>Comment</strong></div>
                    <div fxFlex="50">{{row.comment}}</div>
                </mat-cell>
            </ng-container>

            <mat-header-row *cdkHeaderRowDef="displayedColumns" fxHide.xs fxHide.sm></mat-header-row>
            <mat-row *cdkRowDef="let row; columns: displayedColumns;"></mat-row>
        </mat-table>

        <div class="table-footer" *ngIf="!hasData">
            <span class="total-header">No times found for the selected period and project</span>
        </div>

        <div class="table-footer" *ngIf="totalTime">
            <span class="total-header">Total:</span>
            <span class="total-hours">{{totalTime}} h</span>
        </div>
    </div>
</div>