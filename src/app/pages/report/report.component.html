<md-toolbar color="primary" class="mat-elevation-z8">
    Report
    <span class="fill-remaining-space">
    </span>
    <button md-button (click)="exportReportToCSV()">
        Export
        <md-icon>import_export</md-icon>
    </button>
</md-toolbar>

<div class="inner-sidenav-content">
    <div class="mat-elevation-z5">
        <div class="table-header" fxLayout.gt-xs="row" fxLayout="column" fxLayoutGap="20px" fxLayoutGap.xs="0">

            <!-- Start date -->
            <md-input-container fxFlex="100">
                <input mdInput [mdDatepicker]="fromPicker" placeholder="Starts at" value="{{startDate}}"
                       [max]="endDate" [(ngModel)]="startDate">
                <button mdSuffix [mdDatepickerToggle]="fromPicker"></button>
            </md-input-container>
            <md-datepicker #fromPicker [startAt]="startDate"
                           (selectedChanged)="updateReport()"></md-datepicker>

            <!-- End date -->
            <md-input-container fxFlex="100">
                <input mdInput [mdDatepicker]="toPicker" placeholder="Ends at"
                       value="{{endDate}}" [min]="startDate" [(ngModel)]="endDate">
                <button mdSuffix [mdDatepickerToggle]="toPicker"></button>
            </md-input-container>
            <md-datepicker #toPicker (selectedChanged)="updateReport()"></md-datepicker>

            <!-- Proejct Autocomplete -->
            <md-input-container fxFlex="100">
                <input mdInput placeholder="Project" [mdAutocomplete]="auto" [formControl]="projectsCtrl">
                <md-error>Required</md-error>
            </md-input-container>
            <md-autocomplete #auto="mdAutocomplete" [displayWith]="displayFn">
                <md-option (onSelectionChange)="updateReport($event, emptyProject)"></md-option>
                <md-option *ngFor="let project of filteredProjects | async" [value]="project"
                           (onSelectionChange)="updateReport($event, project)">
                    <span>{{ project.name }}  <span *ngIf="project._id">|</span>  {{ project.number }} </span>
                </md-option>
            </md-autocomplete>
        </div>


        <md-table #table [dataSource]="dataSource">
            <!-- Project number column -->
            <ng-container cdkColumnDef="date">
                <md-header-cell *cdkHeaderCellDef fxHide.xs fxHide.sm><strong>Date</strong></md-header-cell>
                <md-cell *cdkCellDef="let row" fxLayout="row" fxFlex="100%">
                    <div fxHide.gt-sm fxFlex="50"><strong>Date</strong></div>
                    <div fxFlex="50"><strong>{{row.date | encodedDate}}</strong></div>
                </md-cell>
            </ng-container>

            <!-- Project name column -->
            <ng-container cdkColumnDef="from">
                <md-header-cell *cdkHeaderCellDef fxHide.xs fxHide.sm>From</md-header-cell>
                <md-cell *cdkCellDef="let row" fxLayout="row" fxFlex="100">
                    <div fxHide.gt-sm fxFlex="50"><strong>From</strong></div>
                    <div fxFlex="50">{{row.from}} h</div>
                </md-cell>
            </ng-container>

            <ng-container cdkColumnDef="to">
                <md-header-cell *cdkHeaderCellDef fxHide.xs fxHide.sm>To</md-header-cell>
                <md-cell *cdkCellDef="let row" fxLayout="row" fxFlex="100">
                    <div fxHide.gt-sm fxFlex="50">
                        <strong>To</strong>
                    </div>
                    <div fxFlex="50">{{row.to}} h</div>
                </md-cell>
            </ng-container>

            <ng-container cdkColumnDef="spent">
                <md-header-cell *cdkHeaderCellDef fxHide.xs fxHide.sm><strong>Spent</strong></md-header-cell>
                <md-cell *cdkCellDef="let row" fxLayout="row" fxFlex="100">
                    <div fxHide.gt-sm fxFlex="50"><strong>Spent</strong></div>
                    <div fxFlex="50"><strong>{{row.spent}} h</strong></div>
                </md-cell>
            </ng-container>

            <ng-container cdkColumnDef="projectNumber">
                <md-header-cell *cdkHeaderCellDef fxHide.xs fxHide.sm>Project Number</md-header-cell>
                <md-cell *cdkCellDef="let row" fxLayout="row" fxFlex="100">
                    <div fxHide.gt-sm fxFlex="50"><strong>Project Number</strong></div>
                    <div fxFlex="50">{{row.projectNumber}}</div>
                </md-cell>
            </ng-container>

            <ng-container cdkColumnDef="projectName">
                <md-header-cell *cdkHeaderCellDef fxHide.xs fxHide.sm>Project Name</md-header-cell>
                <md-cell *cdkCellDef="let row" fxLayout="row" fxFlex="100">
                    <div fxHide.gt-sm fxFlex="50"><strong>Project Name</strong></div>
                    <div fxFlex="50">{{row.projectName}}</div>
                </md-cell>
            </ng-container>

            <ng-container cdkColumnDef="comment">
                <md-header-cell *cdkHeaderCellDef fxHide.xs fxHide.sm>Comment</md-header-cell>
                <md-cell *cdkCellDef="let row" fxLayout="row" fxFlex="100">
                    <div fxHide.gt-sm fxFlex="50"><strong>Comment</strong></div>
                    <div fxFlex="50">{{row.comment}}</div>
                </md-cell>
            </ng-container>

            <md-header-row *cdkHeaderRowDef="displayedColumns" fxHide.xs fxHide.sm></md-header-row>
            <md-row *cdkRowDef="let row; columns: displayedColumns;"></md-row>
        </md-table>

        <div class="table-footer" *ngIf="!dataSource.hasData">
            <span class="total-header">No times found for the selected period and project</span>
        </div>

        <div class="table-footer" *ngIf="totalTime">
            <span class="total-header">Total:</span>
            <span class="total-hours">{{totalTime}} h</span>
        </div>
    </div>
</div>